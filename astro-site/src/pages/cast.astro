---
import BaseLayout from '../layouts/BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
import HeroSection from '../components/HeroSection.astro';
import { castMembers, qaQuestions } from '../data/cast';

const base = import.meta.env.BASE_URL;
---

<BaseLayout title="Meet the Cast | Echoes of Elsewhere">
  <Nav />

  <main id="main-content">
    <HeroSection portalFetchPriority="high">
      <div class="eyebrow">The Table</div>
      <h1>Meet the Cast</h1>
      <p class="lede">
        Seven voices. One Keeper. Different worlds. Each player steps through the portal with
        a unique perspective and adapts as the rules change around them.
      </p>
      <div class="hero-actions">
        <a class="button" href={base}>Back to Home</a>
        <a class="button secondary" href={`${base}contact`}>Say hello</a>
      </div>
    </HeroSection>

    <section class="shell" id="cast">
      <div class="section-heading" data-reveal>
        <h2>The voices behind the echoes</h2>
      </div>
      <ul class="cast-grid mt-1-6" aria-label="Cast members">
        {castMembers.map((member, memberIndex) => (
          <li>
            <article class="card cast-card" data-reveal>
              <div class="avatar" aria-hidden="true"></div>
              <div class="cast-body">
                <h3>{member.name}</h3>
                <p class="role">{member.role}</p>
                {member.bio && <p class="bio">{member.bio}</p>}
                <ul class="qa-list" role="list">
                  {qaQuestions.map((q, qIndex) => {
                    const answerId = `qa-${memberIndex}-${qIndex}`;
                    const answer = member.qa?.[q.id];
                    const hasAnswer = answer != null && answer.trim() !== '';
                    return (
                      <li class="qa-item">
                        <button
                          type="button"
                          class="qa-question"
                          aria-expanded="false"
                          aria-controls={answerId}
                          id={`${answerId}-btn`}
                          data-qa-toggle
                        >
                          <span class="qa-question-text">{q.question}</span>
                          <span class="qa-chevron" aria-hidden="true"></span>
                        </button>
                        <div
                          id={answerId}
                          class="qa-answer"
                          role="region"
                          aria-labelledby={`${answerId}-btn`}
                          hidden
                        >
                          {hasAnswer ? answer : 'Answer coming soon.'}
                        </div>
                      </li>
                    );
                  })}
                </ul>
                <div class="connect">
                  <span class="label">Connect:</span>
                  {member.website && <a href={member.website}>Website</a>}
                  {member.social && <a href={member.social}>Social</a>}
                </div>
              </div>
            </article>
          </li>
        ))}
      </ul>
    </section>
  </main>

  <Footer />

  <script>
    document.querySelectorAll('[data-qa-toggle]').forEach((btn) => {
      btn.addEventListener('click', () => {
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        const targetId = btn.getAttribute('aria-controls');
        const target = targetId ? document.getElementById(targetId) : null;
        if (!target) return;
        btn.setAttribute('aria-expanded', String(!expanded));
        target.hidden = expanded;
      });
    });
  </script>
</BaseLayout>
